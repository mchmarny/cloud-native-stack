# Network Operator Helm Values
# Generated from Cloud Native Stack Recipe
# Timestamp: {{ .Timestamp }}
# Version: {{ .Version }}

operator:
  {{- if .NetworkOperatorVersion.Value }}
  {{- if .NetworkOperatorVersion.Context }}
  # {{ .NetworkOperatorVersion.Context }}
  {{- end }}
  tag: {{ .NetworkOperatorVersion.Value }}
  {{- end }}

deployCR: true

{{- if .DeployOFED.Context }}
# {{ .DeployOFED.Context }}
{{- end }}
ofedDriver:
  deploy: {{ .DeployOFED.Value }}
  {{- if .OFEDVersion.Value }}
  {{- if .OFEDVersion.Context }}
  # {{ .OFEDVersion.Context }}
  {{- end }}
  version: {{ .OFEDVersion.Value }}
  {{- end }}

{{- if .EnableRDMA.Context }}
# {{ .EnableRDMA.Context }}
{{- end }}
rdmaSharedDevicePlugin:
  deploy: {{ .EnableRDMA.Value }}
  {{- if .EnableRDMA.Value }}
  config:
    resources:
      - name: rdma_shared_device
        rdmaHcaMax: 1000
  {{- end }}

{{- if .EnableSRIOV.Context }}
# {{ .EnableSRIOV.Context }}
{{- end }}
sriovDevicePlugin:
  deploy: {{ .EnableSRIOV.Value }}

{{- if .EnableIPAM.Context }}
# {{ .EnableIPAM.Context }}
{{- end }}
nvIPAM:
  deploy: {{ .EnableIPAM.Value }}
  {{- if .EnableIPAM.Value }}
  config:
    enableWebhook: false
  {{- end }}

secondaryNetwork:
  deploy: true
  {{- if .EnableMultus.Context }}
  # {{ .EnableMultus.Context }}
  {{- end }}
  multus:
    deploy: {{ .EnableMultus.Value }}
  {{- if .EnableWhereabouts.Context }}
  # {{ .EnableWhereabouts.Context }}
  {{- end }}
  ipamPlugin:
    deploy: {{ .EnableWhereabouts.Value }}

nicFeatureDiscovery:
  deploy: true

{{- if .CustomLabels }}
nodeAffinity:
  requiredDuringSchedulingIgnoredDuringExecution:
    nodeSelectorTerms:
    - matchExpressions:
      {{- range $key, $value := .CustomLabels }}
      - key: {{ $key }}
        operator: In
        values:
        - {{ $value }}
      {{- end }}
{{- end }}

{{- if .Namespace }}
namespace: {{ .Namespace }}
{{- end }}

# NIC Feature Discovery Configuration
nfd:
  enabled: true
  deployNodeFeatureRules: true

{{- if .ContainerRuntimeSocket.Context }}
# {{ .ContainerRuntimeSocket.Context }}
{{- end }}
# Container Runtime
containerRuntime:
  socket: {{ .ContainerRuntimeSocket.Value }}
