#!/bin/bash
# Skyhook Operator Uninstallation Script
# Generated by CNS Eidos
# Timestamp: {{ .Timestamp }}
# Bundler Version: {{ .Version }}

set -e

echo "Uninstalling Skyhook Operator..."

# Delete Skyhook CR
echo "Deleting Skyhook custom resource..."
kubectl delete -f manifests/skyhook.yaml --ignore-not-found=true

# Wait for cleanup
echo "Waiting for resources to be cleaned up..."
sleep 10

# Uninstall Helm release
echo "Uninstalling Skyhook Operator Helm release..."
helm uninstall {{ .HelmReleaseName }} -n {{ .Namespace }} || true

# Optionally delete namespace
read -p "Do you want to delete the namespace {{ .Namespace }}? (y/N) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    kubectl delete namespace {{ .Namespace }} --ignore-not-found=true
    echo "Namespace {{ .Namespace }} deleted."
else
    echo "Namespace {{ .Namespace }} preserved."
fi

echo "Skyhook Operator uninstallation complete!"
