# Skyhook Operator Bundle

```shell
Generated from Cloud Native Stack Recipe
Timestamp: {{ .Script.Timestamp }}
Bundler Version: {{ .Script.Version }}
Recipe Version: {{ .Script.RecipeVersion }}
```

## Overview

This bundle contains configuration and deployment artifacts for the NVIDIA Skyhook Operator, which provides automated node optimization for GPU workloads in Kubernetes clusters.

## Contents

- `values.yaml` - Helm chart values for Skyhook Operator deployment
- `manifests/skyhook.yaml` - Skyhook custom resource for node tuning
- `scripts/install.sh` - Automated installation script
- `scripts/uninstall.sh` - Cleanup script
- `checksums.txt` - SHA256 checksums for file integrity verification

## Configuration

### Operator Version

- **Skyhook Operator**: {{ .Helm.SkyhookOperatorVersion }}
- **Skyhook Agent**: {{ .Helm.SkyhookAgentImage }}
- **Kube RBAC Proxy**: {{ .Helm.KubeRbacProxyVersion }}

### Resource Requirements

- **CPU Limit**: {{ .Helm.ManagerCPULimit }}
- **Memory Limit**: {{ .Helm.ManagerMemoryLimit }}
- **CPU Request**: {{ .Helm.ManagerCPURequest }}
- **Memory Request**: {{ .Helm.ManagerMemoryRequest }}

### Node Configuration

- **Runtime Required**: {{ .CR.RuntimeRequired }}
- **Interruption Budget**: {{ .CR.InterruptionBudgetPercent }}%
- **Tuning Package**: {{ .CR.TuningVersion }}

## Installation

### Prerequisites

- Kubernetes cluster (1.29+)
- kubectl configured with cluster access
- Helm 3.x installed
- Cluster admin permissions

### Verify File Integrity

Before installation, verify the checksums:

```bash
sha256sum -c checksums.txt
```

### Quick Install

Run the automated installation script:

```bash
chmod +x scripts/install.sh
./scripts/install.sh
```

### Manual Installation

1. **Create namespace**:
   ```bash
   kubectl create namespace {{ .Helm.Namespace }}
   ```

2. **Add Helm repository**:
   ```bash
   helm repo add skyhook {{ .Script.HelmChartRepo }}
   helm repo update
   ```

3. **Install operator**:
   ```bash
   helm upgrade --install {{ .Script.HelmReleaseName }} skyhook/{{ .Script.HelmChartName }} \
     --namespace {{ .Helm.Namespace }} \
     --create-namespace \
     --values values.yaml \
     --wait
   ```

4. **Apply Skyhook CR**:
   ```bash
   kubectl apply -f manifests/skyhook.yaml
   ```

## Verification

Check operator deployment:

```bash
# Check operator pods
kubectl get pods -n {{ .Helm.Namespace }}

# Check Skyhook resources
kubectl get skyhook -A

# View operator logs
kubectl logs -n {{ .Helm.Namespace }} -l control-plane=controller-manager -f
```

Verify node tuning:

```bash
# Check node labels
kubectl get nodes --show-labels

# Check node conditions
kubectl describe node <node-name>
```

## Customization

### Modifying Node Selectors

Edit `manifests/skyhook.yaml` to change which nodes are tuned:

```yaml
nodeSelectors:
  matchExpressions:
    - key: {{ .CR.NodeSelectorKey }}
      operator: In
      values:
        - your-node-group
```

### Adjusting Resource Limits

Edit `values.yaml` to modify operator resource allocation:

```yaml
controllerManager:
  manager:
    resources:
      limits:
        cpu: {{ .Helm.ManagerCPULimit }}
        memory: {{ .Helm.ManagerMemoryLimit }}
```

### Custom Tuning Configuration

Modify the configMap section in `manifests/skyhook.yaml` to customize:
- GRUB boot parameters
- Sysctl kernel settings
- Containerd service configuration

## Uninstallation

Run the cleanup script:

```bash
chmod +x scripts/uninstall.sh
./scripts/uninstall.sh
```

Or manually:

```bash
# Delete Skyhook CR
kubectl delete -f manifests/skyhook.yaml

# Uninstall Helm release
helm uninstall {{ .Script.HelmReleaseName }} -n {{ .Helm.Namespace }}

# Delete namespace (optional)
kubectl delete namespace {{ .Helm.Namespace }}
```

## Troubleshooting

### Operator Not Starting

Check operator logs:
```bash
kubectl logs -n {{ .Helm.Namespace }} deployment/skyhook-operator-controller-manager
```

### Node Not Being Tuned

1. Check node selectors match your nodes:
   ```bash
   kubectl get nodes -L {{ .CR.NodeSelectorKey }}
   ```

2. Check Skyhook status:
   ```bash
   kubectl describe skyhook {{ .CR.Name }}
   ```

3. Check agent pods on nodes:
   ```bash
   kubectl get pods -A -o wide | grep skyhook-agent
   ```

### Tuning Not Applied

Check configMap:
```bash
kubectl get configmap -n {{ .Helm.Namespace }} | grep skyhook
kubectl describe configmap <configmap-name> -n {{ .Helm.Namespace }}
```

## Support

For issues and questions:
- GitHub Issues: https://github.com/NVIDIA/skyhook/issues
- Documentation: https://github.com/NVIDIA/skyhook

## Recipe Metadata

{{- if .Metadata.Created }}
- **Created**: {{ .Metadata.Created }}
{{- end }}
{{- if .Metadata.RecipeVersion }}
- **Recipe Version**: {{ .Metadata.RecipeVersion }}
{{- end }}
