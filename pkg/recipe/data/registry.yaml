# Component Registry - Declarative configuration for all CNS components
#
# This file defines the bundler configuration for each component.
# Adding a new component only requires adding an entry here - no Go code needed.
#
# Fields:
#   name:              Component identifier used in recipes (e.g., "gpu-operator")
#   displayName:       Human-readable name for templates and output
#   valueOverrideKeys: Alternative keys for --set flag (e.g., --set gpuoperator:key=value)
#   helm:              Default Helm chart settings (for Helm components)
#     defaultRepository: Helm repository URL
#     defaultChart:      Chart name (e.g., "nvidia/gpu-operator")
#     defaultVersion:    Default chart version if not specified in recipe
#   kustomize:         Default Kustomize settings (for Kustomize components)
#     defaultSource:     Git repository or OCI reference
#     defaultPath:       Path within the repository to the kustomization
#     defaultTag:        Git tag, branch, or commit
#   nodeScheduling:    Paths in Helm values where node selectors/tolerations are injected
#
# Note: A component must have either 'helm' OR 'kustomize' configuration, not both.
# Node scheduling paths define WHERE CLI flags like --system-node-selector are applied.
# The actual values come from CLI flags, not from this file.
#
apiVersion: cns.nvidia.com/v1alpha1
kind: ComponentRegistry

components:
  - name: gpu-operator
    displayName: gpu-operator
    valueOverrideKeys:
      - gpuoperator
    helm:
      defaultRepository: https://helm.ngc.nvidia.com/nvidia
      defaultChart: nvidia/gpu-operator
    nodeScheduling:
      system:
        nodeSelectorPaths:
          - operator.nodeSelector
          - node-feature-discovery.gc.nodeSelector
          - node-feature-discovery.master.nodeSelector
        tolerationPaths:
          - operator.tolerations
          - node-feature-discovery.gc.tolerations
          - node-feature-discovery.master.tolerations
      accelerated:
        nodeSelectorPaths:
          - daemonsets.nodeSelector
          - node-feature-discovery.worker.nodeSelector
        tolerationPaths:
          - daemonsets.tolerations
          - node-feature-discovery.worker.tolerations

  - name: network-operator
    displayName: network-operator
    valueOverrideKeys:
      - networkoperator
    helm:
      defaultRepository: https://helm.ngc.nvidia.com/nvidia
      defaultChart: nvidia/network-operator

  - name: cert-manager
    displayName: cert-manager
    valueOverrideKeys:
      - certmanager
    helm:
      defaultRepository: https://charts.jetstack.io
      defaultChart: jetstack/cert-manager
      defaultVersion: v1.17.2
    nodeScheduling:
      system:
        nodeSelectorPaths:
          - nodeSelector
          - webhook.nodeSelector
          - cainjector.nodeSelector
          - startupapicheck.nodeSelector
        tolerationPaths:
          - tolerations
          - webhook.tolerations
          - cainjector.tolerations
          - startupapicheck.tolerations

  - name: skyhook-operator
    displayName: skyhook
    valueOverrideKeys:
      - skyhook
    helm:
      defaultRepository: https://nvidia.github.io/skyhook
      defaultChart: skyhook-operator
    nodeScheduling:
      accelerated:
        nodeSelectorPaths:
          - controllerManager.selectors
        tolerationPaths:
          - controllerManager.tolerations

  - name: nvsentinel
    displayName: nvsentinel
    valueOverrideKeys:
      - nv-sentinel
    helm:
      defaultRepository: https://helm.ngc.nvidia.com/nvidia
      defaultChart: nvidia/nvsentinel
      defaultVersion: v0.6.0
    nodeScheduling:
      system:
        nodeSelectorPaths:
          - global.systemNodeSelector
      accelerated:
        tolerationPaths:
          - global.tolerations

  - name: nvidia-dra-driver-gpu
    displayName: nvidia-dra-driver-gpu
    valueOverrideKeys:
      - dradriver
    helm:
      defaultRepository: https://helm.ngc.nvidia.com/nvidia
      defaultChart: nvidia/nvidia-dra-driver-gpu
    nodeScheduling:
      system:
        tolerationPaths:
          - controller.tolerations
      accelerated:
        tolerationPaths:
          - kubeletPlugin.tolerations

  - name: prometheus
    displayName: prometheus
    valueOverrideKeys:
      - prometheus
    helm:
      defaultRepository: https://prometheus-community.github.io/helm-charts
      defaultChart: prometheus-community/kube-prometheus-stack
      defaultVersion: 81.2.2
    nodeScheduling:
      system:
        nodeSelectorPaths:
          - prometheus.prometheusSpec.nodeSelector
          - alertmanager.alertmanagerSpec.nodeSelector
          - grafana.nodeSelector
          - prometheusOperator.nodeSelector
        tolerationPaths:
          - prometheus.prometheusSpec.tolerations
          - alertmanager.alertmanagerSpec.tolerations
          - grafana.tolerations
          - prometheusOperator.tolerations

  - name: prometheus-adapter
    displayName: prometheus-adapter
    valueOverrideKeys:
      - prometheusadapter
    helm:
      defaultRepository: https://prometheus-community.github.io/helm-charts
      defaultChart: prometheus-community/prometheus-adapter
      defaultVersion: 4.14.0
    nodeScheduling:
      system:
        nodeSelectorPaths:
          - nodeSelector
        tolerationPaths:
          - tolerations
