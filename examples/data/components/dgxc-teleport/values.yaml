# Copyright (c) 2025, NVIDIA CORPORATION.  All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# DGXC Teleport Values
#
# Pre-processed values for teleport-kube-agent Helm chart deployed via Kustomize.
# These values are used by the helmCharts section in the Kustomize configuration.
#
# Configuration:
#   environment: non-prod
#   proxyAddr: nv-stg-dgxc.teleport.sh:443 (staging)
#   kubeClusterName: example-cluster
#   product: k8s-aas
#   nvcrOrg: nvidia

# Teleport agent role
roles: kube

# Teleport proxy server address (staging)
proxyAddr: nv-stg-dgxc.teleport.sh:443

# Kubernetes cluster name for identification in Teleport
kubeClusterName: example-cluster

# Labels for resource identification
labels:
  resource-group: k8aas
  environment: non-prod
  cluster-name: example-cluster
  product: k8s-aas

# Enterprise configuration
enterprise: true
enterpriseImage: nvcr.io/nvidia/teleport-ent-distroless

# Image pull secrets for NVCR
imagePullSecrets:
  - name: nvidia-ngcuser-pull-secret

# Authentication token (placeholder - replaced by Kubernetes join method)
authToken: "fake"

# Join parameters using Kubernetes service account authentication
joinParams:
  method: kubernetes
  tokenName: example-cluster

# Resource requests and limits
resources:
  requests:
    cpu: "1"
    memory: "2Gi"
  limits:
    cpu: "2"
    memory: "4Gi"

# High availability configuration
highAvailability:
  replicaCount: 2
  podDisruptionBudget:
    enabled: true
    minAvailable: 1

# Environment variables for Kubernetes token path
extraEnv:
  - name: KUBERNETES_TOKEN_PATH
    value: /var/run/secrets/tokens/teleport-kube-agent

# Disable automatic updater
updater:
  enabled: false

# Extra volumes for service account token projection
extraVolumes:
  - name: teleport-join-sa-token
    projected:
      sources:
        - serviceAccountToken:
            path: teleport-kube-agent
            expirationSeconds: 600
            audience: nv-stg-dgxc.teleport.sh

# Extra volume mounts for projected token
extraVolumeMounts:
  - name: teleport-join-sa-token
    mountPath: /var/run/secrets/tokens
    readOnly: true

# Prometheus monitoring
podMonitor:
  enabled: true
  interval: 60s
  labels: {}
